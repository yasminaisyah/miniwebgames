<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Aqua-Quest: Capital Hunter</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Bubblegum+Sans&family=Montserrat:wght@700&display=swap');

        body {
            margin: 0;
            overflow: hidden;
            background-color: #001;
            font-family: 'Montserrat', sans-serif;
            cursor: crosshair; /* Add a cool cursor */
        }

        #game-container {
            position: relative;
            width: 100vw;
            height: 100vh;
            /* Deep sea gradient */
            background: linear-gradient(to bottom, #001a33 0%, #000d1a 100%);
        }

        canvas {
            display: block;
        }

        /* UI ELEMENTS */
        #hud-top {
            position: absolute;
            top: 20px;
            width: 100%;
            display: flex;
            justify-content: center;
            pointer-events: none;
        }

        #target-panel {
            background: rgba(0, 40, 80, 0.8);
            border: 3px solid #00ffff;
            border-radius: 20px;
            padding: 15px 40px;
            text-align: center;
            box-shadow: 0 0 20px #00ffff;
            backdrop-filter: blur(5px);
        }

        #target-label {
            color: #00ffff;
            font-size: 18px;
            letter-spacing: 2px;
            margin-bottom: 5px;
        }

        #target-country {
            color: #ffffff;
            font-size: 36px;
            font-weight: 800;
            text-transform: uppercase;
            text-shadow: 0 0 10px #00ffff;
        }

        #score-panel {
            position: absolute;
            top: 30px;
            left: 30px;
            color: #fff;
            font-size: 24px;
            font-family: 'Bubblegum Sans', cursive;
        }

        #oxygen-panel {
            position: absolute;
            top: 30px;
            right: 30px;
            color: #ff5555;
            font-size: 24px;
             font-family: 'Bubblegum Sans', cursive;
        }

        /* Start Screen overlay */
        #start-overlay {
            position: absolute;
            top:0; left:0; width:100%; height:100%;
            background: rgba(0,0,20,0.9);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            color: #fff;
            z-index: 10;
        }
        
        h1 { font-family: 'Bubblegum Sans', cursive; font-size: 60px; color: #00ffff; margin:0;}
        button { padding: 15px 40px; font-size: 24px; background: #00ffff; border: none; border-radius: 30px; cursor: pointer; font-family: 'Montserrat'; font-weight:bold; margin-top: 20px;}
        button:hover { background: #fff; box-shadow: 0 0 20px #fff;}

    </style>
</head>
<body>

<div id="game-container">
    <canvas id="gameCanvas"></canvas>
    
    <div id="hud-top">
        <div id="target-panel">
            <div id="target-label">CURRENT MISSION TARGET</div>
            <div id="target-country">READY?</div>
        </div>
    </div>
    <div id="score-panel">PEARLS: <span id="score-val">0</span></div>
    <div id="oxygen-panel">HULL: <span id="oxy-val">100%</span></div>

    <div id="start-overlay">
        <h1>AQUA-QUEST</h1>
        <p style="font-size: 20px; text-align: center; max-width: 500px;">Pilot your sub with the mouse.<br>Look at the target Country at the top.<br>Pop the bubble with the matching Capital!</p>
        <button onclick="startGame()">DIVE! DIVE! DIVE!</button>
    </div>
</div>

<script>
    /* --- GAME DATA --- */
    // A good mix of easy and medium difficulty
    const geoData = [
        {country: "Japan", capital: "Tokyo"}, {country: "France", capital: "Paris"},
        {country: "UK", capital: "London"}, {country: "Italy", capital: "Rome"},
        {country: "Germany", capital: "Berlin"}, {country: "Spain", capital: "Madrid"},
        {country: "China", capital: "Beijing"}, {country: "Russia", capital: "Moscow"},
        {country: "USA", capital: "Washington"}, {country: "Canada", capital: "Ottawa"},
        {country: "Brazil", capital: "Brasilia"}, {country: "Argentina", capital: "Buenos Aires"},
        {country: "Mexico", capital: "Mexico City"}, {country: "Egypt", capital: "Cairo"},
        {country: "India", capital: "New Delhi"}, {country: "Australia", capital: "Canberra"},
        {country: "Turkey", capital: "Ankara"}, {country: "Thailand", capital: "Bangkok"},
        {country: "Greece", capital: "Athens"}, {country: "Sweden", capital: "Stockholm"},
        {country: "Norway", capital: "Oslo"}, {country: "Peru", capital: "Lima"}
    ];

    /* --- AUDIO SYNTH --- */
    const audioCtx = new (window.AudioContext || window.webkitAudioContext)();

    function playSound(type) {
        if (audioCtx.state === 'suspended') audioCtx.resume();
        const osc = audioCtx.createOscillator();
        const gain = audioCtx.createGain();
        osc.connect(gain); gain.connect(audioCtx.destination);
        const t = audioCtx.currentTime;

        if (type === 'pop') {
            osc.type = 'sine';
            osc.frequency.setValueAtTime(800, t);
            osc.frequency.exponentialRampToValueAtTime(1200, t + 0.1);
            gain.gain.setValueAtTime(0.5, t);
            gain.gain.linearRampToValueAtTime(0, t + 0.1);
            osc.start(t); osc.stop(t + 0.1);
        } else if (type === 'crash') {
            osc.type = 'sawtooth';
            osc.frequency.setValueAtTime(150, t);
            osc.frequency.exponentialRampToValueAtTime(50, t + 0.3);
            gain.gain.setValueAtTime(0.5, t);
            gain.gain.linearRampToValueAtTime(0, t + 0.3);
            osc.start(t); osc.stop(t + 0.3);
        } else if (type === 'sonar') {
             // Subtle background ping
            osc.type = 'sine';
            osc.frequency.setValueAtTime(440, t);
            gain.gain.setValueAtTime(0.05, t);
            gain.gain.exponentialRampToValueAtTime(0.001, t + 1.5);
            osc.start(t); osc.stop(t + 1.5);
        }
    }

    /* --- GAME ENGINE --- */
    const canvas = document.getElementById('gameCanvas');
    const ctx = canvas.getContext('2d');
    const targetCountryLabel = document.getElementById('target-country');
    const scoreVal = document.getElementById('score-val');
    const oxyVal = document.getElementById('oxy-val');

    let active = false;
    let score = 0;
    let hull = 100;
    let frame = 0;
    
    let currentTarget = null;
    let bubbles = [];
    let seaParticles = []; // Little floating plankton

    // Submarine State
    const sub = { x: window.innerWidth/2, y: window.innerHeight/2, radius: 30 };
    let mouseX = sub.x;
    let mouseY = sub.y;

    function resize() { canvas.width = window.innerWidth; canvas.height = window.innerHeight; }
    window.addEventListener('resize', resize);
    resize();
    
    // Mouse movement tracker
    canvas.addEventListener('mousemove', (e) => {
        mouseX = e.clientX;
        mouseY = e.clientY;
    });
    // Touch support
    canvas.addEventListener('touchmove', (e) => {
        e.preventDefault();
        mouseX = e.touches[0].clientX;
        mouseY = e.touches[0].clientY;
    }, {passive: false});

    function pickNewTarget() {
        currentTarget = geoData[Math.floor(Math.random() * geoData.length)];
        targetCountryLabel.innerText = currentTarget.country;
        // Subtle visual cue new target set
        targetCountryLabel.style.transform = "scale(1.2)";
        setTimeout(() => targetCountryLabel.style.transform = "scale(1)", 200);
        if(frame % 300 === 0) playSound('sonar'); // Ping occasionally
    }

    class Bubble {
        constructor(isCorrect) {
            this.r = Math.random() * 20 + 40; // Radius 40-60
            this.x = Math.random() * (canvas.width - this.r*2) + this.r;
            this.y = canvas.height + this.r; // Start below screen
            this.speed = Math.random() * 1 + 1.5;
            this.wobbleSeed = Math.random() * Math.PI * 2;
            this.isCorrect = isCorrect;
            
            if (isCorrect) {
                this.text = currentTarget.capital;
            } else {
                // Pick a wrong answer that isn't the current target's capital
                let wrongCap;
                do {
                   wrongCap = geoData[Math.floor(Math.random() * geoData.length)].capital;
                } while (wrongCap === currentTarget.capital);
                this.text = wrongCap;
            }
        }

        update() {
            this.y -= this.speed;
            // Wobble effect
            this.x += Math.sin(this.wobbleSeed + frame/50) * 0.5;
        }

        draw() {
            ctx.beginPath();
            // Bubble gradient look
            let grad = ctx.createRadialGradient(this.x - this.r/3, this.y - this.r/3, this.r/10, this.x, this.y, this.r);
            grad.addColorStop(0, 'rgba(255,255,255,0.8)');
            grad.addColorStop(0.8, 'rgba(100,200,255,0.3)');
            grad.addColorStop(1, 'rgba(100,200,255,0.1)');
            
            ctx.fillStyle = grad;
            ctx.arc(this.x, this.y, this.r, 0, Math.PI*2);
            ctx.fill();
            ctx.strokeStyle = 'rgba(200,255,255,0.5)';
            ctx.lineWidth = 2;
            ctx.stroke();
            
            // Shine spot
            ctx.beginPath();
            ctx.fillStyle = 'rgba(255,255,255,0.6)';
            ctx.arc(this.x - this.r/2.5, this.y - this.r/2.5, this.r/5, 0, Math.PI*2);
            ctx.fill();

            // Text
            ctx.fillStyle = '#fff';
            ctx.font = 'bold 18px Montserrat';
            ctx.textAlign = 'center';
            ctx.textBaseline = 'middle';
            // Add a slight dark glow behind text for readability
            ctx.shadowColor = 'rgba(0,0,0,0.8)';
            ctx.shadowBlur = 10;
            ctx.fillText(this.text, this.x, this.y);
            ctx.shadowBlur = 0;
        }
    }

    // Simple background particles
    class SeaParticle {
        constructor() {
            this.x = Math.random() * canvas.width;
            this.y = Math.random() * canvas.height;
            this.speed = Math.random() * 0.5 + 0.2;
            this.alpha = Math.random() * 0.5;
        }
        update() {
            this.y -= this.speed;
            if(this.y < 0) this.y = canvas.height;
        }
        draw() {
            ctx.fillStyle = `rgba(200,255,255,${this.alpha})`;
            ctx.beginPath(); ctx.arc(this.x, this.y, 2, 0, Math.PI*2); ctx.fill();
        }
    }

    function drawSub() {
        // Ease sub position towards mouse
        sub.x += (mouseX - sub.x) * 0.1;
        sub.y += (mouseY - sub.y) * 0.1;
        
        ctx.save();
        ctx.translate(sub.x, sub.y);
        
        // Main body
        ctx.fillStyle = '#ffcc00';
        ctx.beginPath();
        ctx.ellipse(0, 0, 50, 30, 0, 0, Math.PI*2);
        ctx.fill();
        ctx.strokeStyle = '#cc9900'; ctx.lineWidth = 3; ctx.stroke();

        // Cockpit window
        ctx.fillStyle = '#88ccff';
        ctx.beginPath(); ctx.arc(15, 0, 15, 0, Math.PI*2); ctx.fill();

        // Propeller (animated)
        ctx.fillStyle = '#aaa';
        ctx.save();
        ctx.translate(-55, 0);
        ctx.rotate(frame/5);
        ctx.fillRect(-5, -25, 10, 50);
        ctx.restore();

        ctx.restore();
    }

    function checkCollisions() {
        for (let i = bubbles.length - 1; i >= 0; i--) {
            const b = bubbles[i];
            // Simple Circle collision detection
            const dx = sub.x - b.x;
            const dy = sub.y - b.y;
            const distance = Math.sqrt(dx*dx + dy*dy);

            if (distance < sub.radius + b.r) {
                // Collision!
                if (b.isCorrect) {
                    score++;
                    scoreVal.innerText = score;
                    playSound('pop');
                    pickNewTarget(); // Get new mission
                } else {
                    hull -= 15;
                    oxyVal.innerText = hull + "%";
                    playSound('crash');
                    // Screen shake
                    canvas.style.transform = `translate(${Math.random()*10-5}px, ${Math.random()*10-5}px)`;
                    setTimeout(()=>canvas.style.transform='none', 100);
                    if(hull <= 0) resetGame();
                }
                bubbles.splice(i, 1); // Remove bubble
            }
        }
    }

    function loop() {
        if (!active) return;
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        frame++;

        // Spawn bubbles randomly
        if (frame % 120 === 0) { // Every 2 seconds approx
             // Spawn 1 correct and 2 distractors
             bubbles.push(new Bubble(true));
             bubbles.push(new Bubble(false));
             setTimeout(() => bubbles.push(new Bubble(false)), 500);
        }

        seaParticles.forEach(p => { p.update(); p.draw(); });

        bubbles.forEach((b, i) => {
            b.update();
            b.draw();
            // Remove if off screen top
            if (b.y + b.r < 0) bubbles.splice(i, 1);
        });

        drawSub();
        checkCollisions();

        requestAnimationFrame(loop);
    }

    function resetGame() {
        hull = 100;
        score = 0;
        scoreVal.innerText = "0";
        oxyVal.innerText = "100%";
        bubbles = [];
        pickNewTarget();
    }

    function startGame() {
        document.getElementById('start-overlay').style.display = 'none';
        active = true;
        resetGame();
        for(let i=0;i<50;i++) seaParticles.push(new SeaParticle());
        loop();
    }

</script>
</body>
</html>