<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Temple of Sums: The Addition Quest</title>
    <style>
        :root {
            --stone-dark: #2c2b26;
            --stone-light: #5a574d;
            --vine-green: #4caf50;
            --gold: #ffd700;
            --text-color: #f0e6d2;
            --bg-gradient: linear-gradient(135deg, #1a1a1a 0%, #0d2b10 100%);
        }

        @import url('https://fonts.googleapis.com/css2?family=Cinzel:wght@700&family=Lato:wght@400;700&display=swap');

        body {
            margin: 0;
            background: var(--bg-gradient);
            color: var(--text-color);
            font-family: 'Lato', sans-serif;
            height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            overflow: hidden;
            user-select: none;
        }

        /* Background Pattern (Vines/Leaves) */
        .bg-pattern {
            position: absolute;
            top: 0; left: 0; width: 100%; height: 100%;
            background-image: 
                radial-gradient(circle at 20% 30%, rgba(76, 175, 80, 0.1) 0%, transparent 10%),
                radial-gradient(circle at 80% 70%, rgba(76, 175, 80, 0.1) 0%, transparent 10%);
            z-index: -1;
        }

        /* Game Container */
        #game-frame {
            width: 90%;
            max-width: 800px;
            background-color: var(--stone-dark);
            border: 4px solid var(--stone-light);
            border-radius: 8px;
            box-shadow: 10px 10px 30px rgba(0,0,0,0.5), inset 0 0 50px rgba(0,0,0,0.5);
            padding: 2rem;
            text-align: center;
            position: relative;
        }

        /* Decorative Corners */
        .corner {
            position: absolute;
            width: 40px;
            height: 40px;
            border: 4px solid var(--gold);
            pointer-events: none;
        }
        .top-left { top: 10px; left: 10px; border-right: none; border-bottom: none; }
        .top-right { top: 10px; right: 10px; border-left: none; border-bottom: none; }
        .bottom-left { bottom: 10px; left: 10px; border-right: none; border-top: none; }
        .bottom-right { bottom: 10px; right: 10px; border-left: none; border-top: none; }

        h1 { font-family: 'Cinzel', serif; color: var(--gold); margin: 0 0 20px 0; text-shadow: 2px 2px 0 #000; letter-spacing: 2px; }

        /* Status Bar */
        .status-bar {
            display: flex;
            justify-content: space-between;
            background: rgba(0,0,0,0.3);
            padding: 10px 20px;
            border-radius: 5px;
            margin-bottom: 2rem;
            font-family: 'Cinzel', serif;
            font-size: 1.2rem;
            border: 1px solid var(--stone-light);
        }
        .gem-icon { color: var(--gold); margin-right: 5px; }

        /* Question Display */
        .question-box {
            background: #e8dcc5; /* Parchment color */
            color: #2c1e0f;
            padding: 30px;
            border-radius: 4px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
            margin-bottom: 2rem;
            min-height: 120px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            position: relative;
            transform: rotate(-1deg);
        }
        
        .question-box::before { /* Tape effect */
            content: '';
            position: absolute;
            top: -10px;
            left: 50%;
            transform: translateX(-50%);
            width: 100px;
            height: 25px;
            background: rgba(255,255,255,0.2);
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }

        .topic-tag {
            position: absolute;
            top: -15px;
            right: 20px;
            background: var(--vine-green);
            color: white;
            padding: 5px 15px;
            font-size: 0.8rem;
            font-weight: bold;
            border-radius: 15px;
            text-transform: uppercase;
            box-shadow: 0 2px 5px rgba(0,0,0,0.3);
            transform: rotate(1deg);
        }

        .math-text { font-size: 2rem; font-weight: bold; }
        .word-text { font-size: 1.3rem; line-height: 1.5; font-style: italic; }
        .variable { color: #d32f2f; font-weight: bold; }

        /* Answer Buttons */
        .grid-options {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }

        .stone-btn {
            background: linear-gradient(to bottom, #5a574d, #3e3b33);
            border: none;
            border-bottom: 5px solid #23211c;
            color: white;
            padding: 20px;
            font-size: 1.5rem;
            font-family: 'Cinzel', serif;
            cursor: pointer;
            border-radius: 5px;
            transition: transform 0.1s, border-bottom 0.1s;
            text-shadow: 1px 1px 2px black;
        }

        .stone-btn:hover { transform: translateY(2px); border-bottom-width: 3px; background: linear-gradient(to bottom, #6b685c, #4a473d); }
        .stone-btn:active { transform: translateY(5px); border-bottom-width: 0px; }
        
        .correct-anim { background: #4caf50 !important; border-bottom-color: #2e7d32 !important; }
        .wrong-anim { background: #d32f2f !important; border-bottom-color: #b71c1c !important; animation: rattle 0.4s; }

        @keyframes rattle { 0% { transform: translateX(0); } 25% { transform: translateX(-5px); } 50% { transform: translateX(5px); } 75% { transform: translateX(-5px); } 100% { transform: translateX(0); } }

        /* Overlay Screens */
        .overlay {
            position: absolute;
            top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(13, 43, 16, 0.95);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 100;
            border-radius: 5px;
        }
        .hidden { display: none; }
        
        .main-btn {
            background: var(--gold);
            color: #2c2b26;
            border: none;
            padding: 15px 40px;
            font-size: 1.2rem;
            font-weight: bold;
            border-radius: 50px;
            cursor: pointer;
            margin-top: 20px;
            font-family: 'Cinzel', serif;
            box-shadow: 0 0 15px var(--gold);
            animation: glow 2s infinite alternate;
        }

        @keyframes glow { from { box-shadow: 0 0 10px var(--gold); } to { box-shadow: 0 0 25px var(--gold); } }

    </style>
</head>
<body>

    <div class="bg-pattern"></div>

    <div id="game-frame">
        <div class="corner top-left"></div>
        <div class="corner top-right"></div>
        <div class="corner bottom-left"></div>
        <div class="corner bottom-right"></div>

        <div id="start-screen" class="overlay">
            <h1>Temple of Sums</h1>
            <p style="margin-bottom: 20px;">Master the Ancient Art of Addition</p>
            <div style="text-align: left; font-size: 0.9rem; margin-bottom: 20px; color: #aaa;">
                Topics:<br>‚Ä¢ Basic Addition<br>‚Ä¢ Finding Unknowns (Algebraic)<br>‚Ä¢ Word Problems
            </div>
            <button class="main-btn" onclick="initGame()">Enter Temple</button>
        </div>

        <div id="end-screen" class="overlay hidden">
            <h1>Temple Sealed</h1>
            <p>Your Journey Ends Here.</p>
            <p style="font-size: 1.5rem; color: var(--gold);">Score: <span id="final-score">0</span></p>
            <button class="main-btn" onclick="initGame()">Try Again</button>
        </div>

        <div class="status-bar">
            <div><span class="gem-icon">üíé</span> <span id="score">0</span></div>
            <div>Level <span id="level">1</span></div>
            <div style="color: #ff6b6b;"><span id="lives">‚ù§Ô∏è‚ù§Ô∏è‚ù§Ô∏è</span></div>
        </div>

        <div class="question-box">
            <div id="topic-tag" class="topic-tag">Addition</div>
            <div id="question-display" class="math-text">Loading...</div>
        </div>

        <div id="options-container" class="grid-options">
            </div>
    </div>

<script>
    /* --- AUDIO SYSTEM (Synthesized) --- */
    const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
    
    function playTone(freq, type, duration) {
        if(audioCtx.state === 'suspended') audioCtx.resume();
        const osc = audioCtx.createOscillator();
        const gain = audioCtx.createGain();
        
        osc.type = type;
        osc.frequency.setValueAtTime(freq, audioCtx.currentTime);
        
        gain.gain.setValueAtTime(0.1, audioCtx.currentTime);
        gain.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + duration);
        
        osc.connect(gain);
        gain.connect(audioCtx.destination);
        osc.start();
        osc.stop(audioCtx.currentTime + duration);
    }

    function soundCorrect() {
        playTone(400, 'sine', 0.1);
        setTimeout(() => playTone(600, 'sine', 0.2), 100);
        setTimeout(() => playTone(1000, 'sine', 0.4), 200);
    }

    function soundWrong() {
        playTone(150, 'sawtooth', 0.4);
        setTimeout(() => playTone(100, 'sawtooth', 0.4), 100);
    }

    /* --- GAME LOGIC --- */
    let gameState = {
        score: 0,
        level: 1,
        lives: 3,
        active: false
    };

    function initGame() {
        gameState = { score: 0, level: 1, lives: 3, active: true };
        document.getElementById('start-screen').classList.add('hidden');
        document.getElementById('end-screen').classList.add('hidden');
        updateHUD();
        nextQuestion();
    }

    function updateHUD() {
        document.getElementById('score').innerText = gameState.score;
        document.getElementById('level').innerText = gameState.level;
        document.getElementById('lives').innerText = "‚ù§Ô∏è".repeat(gameState.lives);
    }

    function endGame() {
        gameState.active = false;
        soundWrong();
        document.getElementById('final-score').innerText = gameState.score;
        document.getElementById('end-screen').classList.remove('hidden');
    }

    function rand(min, max) {
        return Math.floor(Math.random() * (max - min + 1)) + min;
    }

    function formatNum(n) {
        return n.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ",");
    }

    /* --- QUESTION GENERATORS --- */
    
    // 1. Standard Addition
    function getStandardAddition() {
        // Difficulty scaling: Level 1 (2-digits) -> Level 10 (5-digits)
        let digits = Math.min(2 + Math.floor(gameState.level / 2), 5);
        let min = Math.pow(10, digits - 1);
        let max = Math.pow(10, digits) - 1;

        let a = rand(min, max);
        let b = rand(min, max);
        let ans = a + b;

        return {
            type: "Standard Addition",
            text: `<span class="math-text">${formatNum(a)} + ${formatNum(b)} = ?</span>`,
            correct: ans
        };
    }

    // 2. Unknown in Addition (Algebra logic)
    function getUnknownAddition() {
        let digits = Math.min(2 + Math.floor(gameState.level / 2), 5);
        let min = Math.pow(10, digits - 1);
        let max = Math.pow(10, digits) - 1;

        let a = rand(min, max);
        let b = rand(min, max);
        let total = a + b;

        // Randomly hide A or B
        let hideFirst = Math.random() > 0.5;
        let text = hideFirst 
            ? `<span class="variable">?</span> + ${formatNum(b)} = ${formatNum(total)}`
            : `${formatNum(a)} + <span class="variable">?</span> = ${formatNum(total)}`;

        return {
            type: "Find Unknown",
            text: `<span class="math-text">${text}</span>`,
            correct: hideFirst ? a : b
        };
    }

    // 3. Word Problems
    function getWordProblem() {
        let digits = Math.min(2 + Math.floor(gameState.level / 3), 4);
        let min = Math.pow(10, digits - 1);
        let max = Math.pow(10, digits) - 1;
        
        let a = rand(min, max);
        let b = rand(min, max);
        let ans = a + b;

        const templates = [
            `The East Temple has <b>${formatNum(a)}</b> gold coins. The West Temple has <b>${formatNum(b)}</b> coins. How many coins are there in total?`,
            `A merchant sold <b>${formatNum(a)}</b> apples on Monday and <b>${formatNum(b)}</b> apples on Tuesday. What is the total sold?`,
            `Explorer Sarah walked <b>${formatNum(a)}</b> meters, rested, and then walked <b>${formatNum(b)}</b> more meters. Total distance?`,
            `A library has <b>${formatNum(a)}</b> science books and <b>${formatNum(b)}</b> history books. How many books total?`
        ];

        let text = templates[rand(0, templates.length - 1)];

        return {
            type: "Problem Solving",
            text: `<span class="word-text">${text}</span>`,
            correct: ans
        };
    }

    function nextQuestion() {
        if (!gameState.active) return;

        // Choose question type based on level
        let roll = Math.random();
        let qData;

        // Levels 1-2: Mostly standard
        // Levels 3-4: Standard + Unknowns
        // Levels 5+: Everything + Word Problems
        if (gameState.level < 3) {
            qData = getStandardAddition();
        } else if (gameState.level < 5) {
            qData = roll > 0.4 ? getStandardAddition() : getUnknownAddition();
        } else {
            if (roll < 0.33) qData = getStandardAddition();
            else if (roll < 0.66) qData = getUnknownAddition();
            else qData = getWordProblem();
        }

        renderQuestion(qData);
    }

    function renderQuestion(data) {
        document.getElementById('topic-tag').innerText = data.type;
        document.getElementById('question-display').innerHTML = data.text;
        
        // Generate answers (1 correct, 3 wrong)
        let answers = [data.correct];
        
        // Create clever distractors
        while(answers.length < 4) {
            let offset = rand(1, 20) * Math.pow(10, rand(0, 2)); // varied offsets
            let wrong = Math.random() > 0.5 ? data.correct + offset : data.correct - offset;
            if (wrong > 0 && !answers.includes(wrong)) {
                answers.push(wrong);
            }
        }

        // Shuffle answers
        answers.sort(() => Math.random() - 0.5);

        const container = document.getElementById('options-container');
        container.innerHTML = '';

        answers.forEach(ans => {
            let btn = document.createElement('button');
            btn.className = 'stone-btn';
            btn.innerText = formatNum(ans);
            btn.onclick = () => checkAnswer(btn, ans, data.correct);
            container.appendChild(btn);
        });
    }

    function checkAnswer(btn, value, correct) {
        if (!gameState.active) return;
        
        // Disable all buttons momentarily
        let allBtns = document.querySelectorAll('.stone-btn');
        allBtns.forEach(b => b.disabled = true);

        if (value === correct) {
            btn.classList.add('correct-anim');
            soundCorrect();
            gameState.score += 100 + (gameState.level * 10);
            
            // Level up logic
            if (gameState.score > gameState.level * 800) {
                gameState.level++;
            }
            
            updateHUD();
            setTimeout(nextQuestion, 1000);
        } else {
            btn.classList.add('wrong-anim');
            soundWrong();
            gameState.lives--;
            updateHUD();
            
            // Highlight the correct one
            allBtns.forEach(b => {
                if (parseInt(b.innerText.replace(/,/g, '')) === correct) {
                    b.classList.add('correct-anim');
                    b.style.opacity = "0.7";
                }
            });

            if (gameState.lives <= 0) {
                setTimeout(endGame, 1000);
            } else {
                setTimeout(nextQuestion, 1500);
            }
        }
    }
</script>
</body>
</html>